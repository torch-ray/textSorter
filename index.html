<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹œê°„ ì •ë ¬ê¸°</title>
</head>
<body>
  <h2>í˜œìœ¤ì´ì˜ í…ìŠ¤íŠ¸ íŒŒì¼ ì‹œê°„ ì •ë ¬ê¸°2</h2>
  <input type="file" multiple id="fileInput">
  <button onclick="processFiles()">ì •ë ¬ ì‹œì‘</button>

  <script>
    function parseTime(str) {
      if (typeof str !== 'string' || !str.includes(':')) {
        console.warn(`ì˜ëª»ëœ ì‹œê°„ í˜•ì‹ì…ë‹ˆë‹¤: "${str}"`);
        return null;
      }
      const parts = str.split(":");
      if (parts.length !== 2) {
        console.warn(`ì˜ëª»ëœ ì‹œê°„ í˜•ì‹ì…ë‹ˆë‹¤: "${str}"`);
        return null;
      }
      
      const min = parseInt(parts[0], 10);
      const sec = parseFloat(parts[1]);

      if (isNaN(min) || isNaN(sec)) {
        console.warn(`ì‹œê°„ì„ ìˆ«ìë¡œ ë³€í™˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "${str}"`);
        return null;
      }
      return min * 60 + sec;
    }

    function processFile(content) {
      const lines = content.split("\n").filter(line => line.trim());
      const entries = [];

      lines.forEach(line => {
        const parts = line.split("\t");
        if (parts.length < 3) {
          console.warn(`ë°ì´í„° ì—´ì´ ë¶€ì¡±í•©ë‹ˆë‹¤: "${line}"`);
          return;
        }

        const timeValue = parseTime(parts[2]);

        if (timeValue !== null) {
          entries.push({ time: timeValue, line: line });
        }
      });
      
      entries.sort((a, b) => a.time - b.time);

      return entries.map(e => e.line).join("\n");
    }

    function processFiles() {
      const input = document.getElementById("fileInput");
      if (input.files.length === 0) {
        alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      Array.from(input.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const sorted = processFile(e.target.result);

          // ğŸš¨ ì •ë ¬ ê²°ê³¼ê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
          if (!sorted.trim()) {
            alert(`[${file.name}] íŒŒì¼ì—ì„œ ì •ë ¬í•  ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n\níŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”:\n- ê° ì¤„ì´ íƒ­(Tab)ìœ¼ë¡œ êµ¬ë¶„\n- ì„¸ ë²ˆì§¸ ì—´ì— 'ë¶„:ì´ˆ' í˜•ì‹ì˜ ì‹œê°„`);
            return; // íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤‘ì§€
          }

          const blob = new Blob([sorted], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = file.name; // ğŸ‘ˆ ì›ë³¸ íŒŒì¼ëª… ê·¸ëŒ€ë¡œ ì‚¬ìš©
          a.click();
          URL.revokeObjectURL(a.href);
        };
        reader.readAsText(file, "utf-8");
      });
    }
  </script>
</body>
</html>