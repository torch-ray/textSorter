<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>시간 정렬기</title>
</head>
<body>
  <h2>혜윤이의 텍스트 파일 시간 정렬기2</h2>
  <input type="file" multiple id="fileInput">
  <button onclick="processFiles()">정렬 시작</button>

  <script>
    function parseTime(str) {
      if (typeof str !== 'string' || !str.includes(':')) {
        console.warn(`잘못된 시간 형식입니다: "${str}"`);
        return null;
      }
      const parts = str.split(":");
      if (parts.length !== 2) {
        console.warn(`잘못된 시간 형식입니다: "${str}"`);
        return null;
      }
      
      const min = parseInt(parts[0], 10);
      const sec = parseFloat(parts[1]);

      if (isNaN(min) || isNaN(sec)) {
        console.warn(`시간을 숫자로 변환할 수 없습니다: "${str}"`);
        return null;
      }
      return min * 60 + sec;
    }

    function processFile(content) {
      const lines = content.split("\n").filter(line => line.trim());
      const entries = [];

      lines.forEach(line => {
        const parts = line.split("\t");
        if (parts.length < 3) {
          console.warn(`데이터 열이 부족합니다: "${line}"`);
          return;
        }

        const timeValue = parseTime(parts[2]);

        if (timeValue !== null) {
          entries.push({ time: timeValue, line: line });
        }
      });
      
      entries.sort((a, b) => a.time - b.time);

      return entries.map(e => e.line).join("\n");
    }

    function processFiles() {
      const input = document.getElementById("fileInput");
      if (input.files.length === 0) {
        alert("파일을 선택해주세요.");
        return;
      }

      Array.from(input.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const sorted = processFile(e.target.result);

          // 🚨 정렬 결과가 비어있는지 확인하고 사용자에게 알림
          if (!sorted.trim()) {
            alert(`[${file.name}] 파일에서 정렬할 유효한 데이터를 찾지 못했습니다.\n\n파일 형식을 확인해주세요:\n- 각 줄이 탭(Tab)으로 구분\n- 세 번째 열에 '분:초' 형식의 시간`);
            return; // 파일 다운로드 중지
          }

          const blob = new Blob([sorted], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = file.name; // 👈 원본 파일명 그대로 사용
          a.click();
          URL.revokeObjectURL(a.href);
        };
        reader.readAsText(file, "utf-8");
      });
    }
  </script>
</body>
</html>